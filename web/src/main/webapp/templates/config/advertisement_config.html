<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title></title>
    <link href="http://resali.huobanplus.com/cdn/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/hotui/css/animate.min.css" rel="stylesheet"/>
    <link href="http://resali.huobanplus.com/cdn/hotui/css/style.min-1.0.8.css" rel="stylesheet"/>
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight tooltip-demo" th:object="${data}">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-content">
                    <form class="form-horizontal" method="post">
                        <div class="form-inline">
                            <div class="form-group">
                                <label class="control-label">新增修改广告</label>
                                <input type="hidden" id="id" name="id" th:value="*{id}">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group ">
                                <label>标题：</label>
                                <input type="text" id="title" name="title" class="form-control"
                                       value="" th:value="*{title}">
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group"  id="showImg">
                                <label>图片</label>
                                <input type="hidden" id="imageUrl" name="imageUrl" th:value="*{imageUrl}"/>
                                <input type="file" id="uploadFile" name="btnFile" readonly="readonly" class="form-control">
                                <button class="btn btn-success" id="uploadImage" type="button"
                                        onclick="handler.uploadFile()">上传图片
                                </button>

                                <span class="help-block"><i class="fa fa-info-circle"></i>推荐尺寸：400*300</span>

                                <img id="imageShow"  th:src="${imageUrlFull}"
                                     style="width:400px;height:300px;"/>
                            </div>
                        </div>
                        <div class="form-inline">
                            <div class="form-group ">
                                <label>跳转地址：</label>
                                <input type="text" id="targetUrl" name="targetUrl" class="form-control"
                                       value="" th:value="*{targetUrl}">
                            </div>
                        </div>

                        <div class="form-inline">
                            <div class="form-group ">
                                <label>排序：</label>
                                <input type="text" id="sort" name="sort" class="form-control only-int"
                                       value="" th:value="*{sort}">
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-sm-8 col-sm-offset-5">
                                <button class="btn btn-success btn-submit" type="button" id="infoSubmit"
                                        onclick="handler.save()">提交
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="http://resali.huobanplus.com/cdn/jquery/2.2.4/jquery.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/bootstrap/3.3.5/bootstrap.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/v2/content.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/layer/3.1.0/layer.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/v2/bootstrap.hot.extra-utils-0.2.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/v2/bootstrap.hot.extra-init.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/ajaxfileupload/ajaxfileupload.js"></script>

<script type="text/javascript">

    var handler = {
        save: function () {
            var id = $("#id").val();
            var title = $('#title').val();
            var imageUrl = $("#imageUrl").val();
            var targetUrl = $("#targetUrl").val();
            var sort = $("#sort").val();
            var request = {
                id:id,
                title: title,
                imageUrl: imageUrl,
                targetUrl: targetUrl,
                sort:sort
            };

            hot.ajax("/admin/config/advertisementConfigDo", request, function (data) {
                if (data.resultCode == 2000) {
                    hot.tip.success("操作成功");
                    setTimeout(function () {
                        window.location.href = "/admin/config/advertisementList";
                    }, 1000);
                } else {
                    hot.tip.error("保存失败：" + data.resultMsg);
                }
            }, function () {
            }, "post", 100);
        },
        uploadFile: function () {
            if ($('#uploadFile').val() == undefined || $('#uploadFile').val().length == 0) {
                hot.tip.msg("图片不能为空");
            } else {
                hot.loading.show();
                $.ajaxFileUpload({
                    url: "/admin/config/uploadImg",
                    secureuri: false,// 一般设置为false
                    fileElementId: "uploadFile",// 文件上传表单的id <input type="file" id="fileUpload" name="file" />
                    dataType: 'json',// 返回值类型 一般设置为json
                    type: "post",
                    success: function (res) // 服务器成功响应处理函数
                    {
                        if (res.resultCode == 2000) {
                            $('#imageShow').attr('src', res.data.fileUrl);
                            $("input:hidden[name='imageUrl']").val(res.data.fileUri);
                            hot.tip.success("图片上传成功");
                        } else {
                            hot.loading.hide();
                        }
                    },
                    error: function (data)// 服务器响应失败处理函数
                    {
                        hot.tip.error(data.data);
                    }
                })
            }
        }
    }
</script>
</body>
</html>
